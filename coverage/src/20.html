<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/Users/jt/repos/FetchRewardsTakeHome/FetchRewardsTakeHome/Business/Repositories/Points/PointsRepository.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using FetchRewardsTakeHome.Business.Repositories.Exceptions;
using FetchRewardsTakeHome.Business.Repositories.Models;
using FetchRewardsTakeHome.Data;

namespace FetchRewardsTakeHome.Business.Repositories.Points;

public class PointsRepository : IPointsRepository
{
    private readonly FakeDatabase _database;

    public PointsRepository(FakeDatabase database)
    {
        _database = database;
    }

    public Task&lt;PointsModel&gt; InsertTransaction(PointsModel points)
    {
        var dbModel = points.ToDataModel();
        _database.Transactions.Add(dbModel);
        var returnModel = new PointsModel(dbModel);
        return Task.FromResult(returnModel);
    }

    public Task&lt;PointsModel&gt; FindTransaction(Guid id)
    {
        var model = _database.Transactions.FirstOrDefault(t =&gt; t.Id == id);
        if (model == null) throw new TransactionNotFound(id);
        return Task.FromResult(new PointsModel(model));
    }
    
    public Task&lt;List&lt;PointsModel&gt;&gt; GetSortedTransactions()
    {
        var transactions = _database.
            Transactions.Select(t =&gt; new PointsModel(t))
            .Where(t =&gt; t.Points &lt; 0)
            .OrderBy(t =&gt; t.TimeStamp)
            .ToList();
        
        var positiveTransactions = _database.
            Transactions.Select(t =&gt; new PointsModel(t))
            .Where(t =&gt; t.Points &gt;= 0)
            .OrderBy(t =&gt; t.TimeStamp)
            .ToList();

        transactions.AddRange(positiveTransactions);
        return Task.FromResult(transactions);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[11,5,11,51,1],[12,5,12,6,1],[13,9,13,30,1],[14,5,14,6,1],[17,5,17,6,1],[18,9,18,44,1],[19,9,19,45,1],[20,9,20,52,1],[21,9,21,45,1],[22,5,22,6,1],[25,5,25,6,1],[26,9,26,64,1],[26,64,26,74,1],[26,74,26,76,1],[27,9,27,27,1],[27,28,27,62,1],[28,9,28,56,1],[29,5,29,6,1],[32,5,32,6,1],[33,9,34,38,1],[34,38,34,56,1],[34,56,35,25,1],[35,25,35,37,1],[35,37,36,27,1],[36,27,36,38,1],[36,38,37,23,1],[39,9,40,38,1],[40,38,40,56,1],[40,56,41,25,1],[41,25,41,38,1],[41,38,42,27,1],[42,27,42,38,1],[42,38,43,23,1],[45,9,45,53,1],[46,9,46,46,1],[47,5,47,6,1]]);
    </script>
  </body>
</html>